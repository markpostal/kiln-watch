<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="icon" href="data:;base64,=">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <script type="text/javascript" src="https://d3js.org/d3.v7.min.js"></script>
    <script type="text/javascript" src="site.js"></script>
    <title>Kiln Watch Service</title>
</head>
<body>
	<style>
		.chart-title { 
			font-size: 14pt; 
		}
	</style>
    <div id="legend"></div>
    <p></p>
    <div id="temp_chart"></div>
    <p></p>
    <div id="ramp_chart"></div>
    <script>
        // Create the legend
        const legend_obj = new Legend(928, false);
        const legend_chart = legend_obj.createChart([]);
        d3.select('#legend').append(() => legend_chart.node());

        // Create the temperature chart
        const temp_obj = new TemperatureChart(928, 500, false);
        const temp_chart = temp_obj.createChart([]);
        d3.select('#temp_chart').append(() => temp_chart.node());

        // Create the ramp chart
        const ramp_obj = new RampChart(928, 500);
        const ramp_chart = ramp_obj.createChart([]);
        d3.select('#ramp_chart').append(() => ramp_chart.node());

        // Update the data
        d3.json("/records").then(json => {
            temp_obj.updateChartData(temp_chart, json);
            ramp_obj.updateChartData(ramp_chart, json);
            legend_obj.updateChartData(legend_chart, json);
        })
        .catch(error => {
            console.error("Error loading JSON data:", error);
        });

        // Continue to update the charts periodically
        var intervalId = setInterval(function() {
            d3.json("/records").then(json => {
                temp_obj.updateChartData(temp_chart, json);
                ramp_obj.updateChartData(ramp_chart, json);
                legend_obj.updateChartData(legend_chart, json);
            })
            .catch(error => {
                console.error("Error loading JSON data:", error);
            });
        }, 60000);
    </script>
</body>
</html>
